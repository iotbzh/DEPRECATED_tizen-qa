<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/meta.css' />
    <script src='/javascripts/meta.js' type='text/javascript'></script>
  </head>
  <body>
    <div class="helpme"><a href='/help/help.html' target='_blank'>Help Me Please!</a></div>
    <h1><%= title %></h1>
    <p>Browsing Test Case <%= file %></p>
    <p><a href="<%=up.href%>"><%=up.name%></a></p>
    <p><form id="newtc" method="post" action="<%=post+'?a=n'%>"><input type="submit" value="New case"></form></p>
    <%
	function opt(d,name,def) {
	    var i, a = def.split('|'), val=d[name] || ''; %>
	    <select name="<%=name%>">
	    <%
	    for(i in a){%>
		<option value="<%=a[i]%>"<%=(a[i]==val ? ' selected' : '')%>><%=a[i]%></option>
	    <% } %>
	    </select>
	    <%
	}
	function stepsToString(d) {
		if (!(d.steps && d.steps.length)) return "";
		var x=[];
		d.steps.forEach(function(s) {
			if ('description' in s) {
				x.push(s.description.replace(/\n/g," "));
			}
			if ('expected' in s) { 
				x.push(' => ');
				x.push(s.expected.replace(/\n/g," "));
			}
			x.push("\n");
		});
		x.pop(); // remove last \n
		x=x.join("");
		%><%=x%><%
	}
	var n, s, num, d;
	for (num in defs) { 
	    d = defs[num];
	    %>
	    <form class="ftc" id="<%=num%>">
		<label class="aligned" for="id">ID</label>
		<span class="ftcid"><%=num%></span>

		<label>Author:</label>
		<span><%=d.author||"N/A"%></span>
		&nbsp;
		<label>Created:</label>
		<span><%=d.ctime||"N/A"%></span>
		&nbsp;
		<label>Modified:</label>
		<span><%=d.mtime||"N/A"%></span>
		&nbsp;
		<div style="float:right">
			<input type="submit" value="Save" formmethod="post" formaction="<%=post+'?a=m&n='+num%>">
			<input type="submit" value="Delete" formmethod="post" formaction="<%=post+'?a=d&n='+num%>">
			<input type="submit" value="Clone" formmethod="post" formaction="<%=post+'?a=c&n='+num%>">
			<% if(num > 0) { %>
				<input type="submit" value="Move up" formmethod="post" formaction="<%=post+'?a=gu&n='+num%>">
			<% } %>
			<% if(num < defs.length-1) { %>
				<input type="submit" value="Move down" formmethod="post" formaction="<%=post+'?a=gd&n='+num%>">
			<% } %>
		</div>
		<br>
		<hr/>

		<label class="aligned" for="name">name</label>
		<input name="name" class="small" type="text" value="<%=d.name%>">
	    <br>

		<label class="aligned" for="exec_type">exec_type</label>
		<%opt(d,'exec_type','auto|manual');%>

		<label for="priority">priority</label>
		<input name="priority" style="width:5em;" type="number" min="0" step="1" max="100" value="<%=d.priority || 0%>">

		<label for="status">status</label>
		<%opt(d,'status','designed|ready|approved|disabled');%>

		<label for="type">type</label>
		<%opt(d,'type','functional_positive|functional_negative|security|performance|reliability|portability|maintainability|user_experience|compliance|');%>

		<label for="subtype">subtype</label>
		<input name="subtype" class="small" type="text" value="<%=d.subtype||''%>">

	    <br>

		<label class="aligned" for="objective">objective</label>
		<input name="objective" class="large" type="text" value="<%=d.objective%>">
	    <br>
		<label class="aligned" for="description">description</label>
		<textarea name="description" rows="4"><%=d.description%></textarea>
	    <br>
<div class="ifmanual">
		<label class="aligned" for="pre_condition">pre_condition</label>
		<textarea name="pre_condition" rows="4"><%=d.pre_condition%></textarea>
	    <br>

		<label class="aligned" for="steps">steps</label>
		<textarea name="steps" rows="4"><%stepsToString(d);%></textarea>
		<br>

		<label class="aligned" for="post_condition">post_condition</label>
		<input name="post_condition" class="large" type="text" value="<%=d.post_condition%>">
	    <br>
</div>
		<label class="aligned" for="notes">notes</label>
		<input name="notes" class="large" type="text" value="<%=d.notes%>">
	    <br>
		<label class="aligned" for="bugs">bugs</label>
		<input name="bugs" class="large" type="text" value="<%=d.bugs%>">
	    <br>

		<label class="aligned" for="exec_pre">exec_pre</label>
		<input name="exec_pre" class="large" type="text" value="<%=d.exec_pre||''%>">

	    <br>

<div class="ifauto">
		<label class="aligned" for="exec">exec</label>
		<input name="exec" class="large" type="text" value="<%=d.exec%>">
	    <br>
		<label class="aligned" for="exec_expected_retcode">exec_expected_retcode</label>
		<input name="exec_expected_retcode" type="number" min="0" step="1" max="127" value="<%=d.exec_expected_retcode || 0%>">

		<label for="exec_kill_timeout">exec_kill_timeout</label>
		<input name="exec_kill_timeout" type="number" min="0" step="1" max="864000" value="<%=d.exec_kill_timeout || 0%>">
	    <br>
</div>

		<label class="aligned" for="exec_post">exec_post</label>
		<input name="exec_post" class="large" type="text" value="<%=d.exec_post||''%>">
	    <br>
<% for(n in d) switch(n){
case "author":
case "ctime":
case "mtime":
case "name":
case "priority":
case "status":
case "type":
case "subtype":
case "objective":
case "description":
case "pre_condition":
case "steps":
case "post_condition":
case "notes":
case "bugs":
case "exec_type":
case "exec_pre":
case "exec":
case "exec_expected_retcode":
case "exec_kill_timeout":
case "exec_post":
	break;
default: 
    s = d[n]||'';
    if (typeof s == 'object') s=JSON.stringify(s);
%>
		<label class="aligned" for="<%=n%>"><%=n%></label>
		<input name="<%=n%>" class="large" type="text" value="<%=s%>">
<%}%>

	    </form>
	    <% 
	}
    %>
<% if(false) { %>
    <p><form><input type="submit" value="New case" formmethod="post" formaction="<%=post+'?a=n'%>"></form></p>
<% } %>
  </body>
</html>

